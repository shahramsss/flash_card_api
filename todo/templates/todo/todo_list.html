{% extends 'base.html' %}
{% load jalali_filters %}
{% load static %}

{% block content %}
  <div class="container py-4" dir="rtl">
    <!-- Ø¹Ù†ÙˆØ§Ù† -->
    <div class="mb-4">
      <h3 class="fw-bold">ğŸ“‹ ÙˆØ¸Ø§ÛŒÙ Ù…Ù†</h3>
    </div>

    <!-- ØªØ¨â€ŒÙ‡Ø§ -->
    <ul class="nav nav-tabs mb-4" id="todoTabs" role="tablist">
      <!-- Û±Û´ Ø±ÙˆØ² -->
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="days-tab" data-bs-toggle="tab" data-bs-target="#days" type="button">ğŸ“… Û±Û´ Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡</button>
      </li>

      <!-- Ø¢ÛŒÙ†Ø¯Ù‡ -->
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="future-tab" data-bs-toggle="tab" data-bs-target="#future" type="button">
          â³ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡{% if future_todos %}
            <span class="badge bg-warning text-dark ms-1">{{ future_todos|length }}</span>
          {% endif %}
        </button>
      </li>
      <!-- ØªØ¨ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡ -->
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="daily-tab" data-bs-toggle="tab" data-bs-target="#daily" type="button">
          ğŸŒ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡{% if daily_todos %}
            <span class="badge bg-info ms-1">{{ daily_todos|length }}</span>
          {% endif %}
        </button>
      </li>
      <!-- ØªØ¨ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù…â€ŒÙ†Ø´Ø¯Ù‡ Ú¯Ø°Ø´ØªÙ‡ -->
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="past-tab" data-bs-toggle="tab" data-bs-target="#past" type="button">
          ğŸ•’ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ú¯Ø°Ø´ØªÙ‡{% if past_todos %}
            <span class="badge bg-danger ms-1">{{ past_todos|length }}</span>
          {% endif %}
        </button>
      </li>

      <!-- Ø«Ø¨Øª -->
      <li class="nav-item ms-auto" role="presentation">
        <button class="nav-link text-success" id="create-tab" data-bs-toggle="tab" data-bs-target="#create" type="button">â• Ø«Ø¨Øª ÙˆØ¸ÛŒÙÙ‡</button>
      </li>
    </ul>

    <!-- Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨â€ŒÙ‡Ø§ -->
    <div class="tab-content">
      <!-- Ù…Ø­ØªÙˆØ§ ØªØ¨ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡ -->
      <div class="tab-pane fade" id="daily">
        {% if daily_todos %}
          <div class="list-group shadow-sm">
            {% for todo in daily_todos %}
              <a href="{% url 'todo:todo_daily_confirm' todo.id %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge me-2
              {% if todo.priority == 'high' %}
                      bg-danger

                    {% elif todo.priority == 'medium' %}
                      bg-warning text-dark

                    {% else %}
                      bg-info
                    {% endif %}
            ">
                    {{ todo.get_priority_display }}
                  </span>
                  {{ todo.title }}
                </div>
                <small class="text-muted">{{ todo.due_date|to_jalali }}</small>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-light text-center">ğŸ‰ Ú©Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>
        {% endif %}
      </div>

      <!-- ØªØ¨ Û±Û´ Ø±ÙˆØ² -->
      <div class="tab-pane fade show active" id="days">
        <div class="table-responsive shadow-sm rounded">
          <table class="table table-bordered align-middle mb-0">
            <thead class="table-light text-center">
              <tr>
                <th style="width:140px;">ØªØ§Ø±ÛŒØ®</th>
                <th style="width:120px;">Ø±ÙˆØ²</th>
                <th>Ú©Ø§Ø±Ù‡Ø§</th>
              </tr>
            </thead>
            <tbody>
              {% for day, todos in days_dict.items %}
                <tr class="{% if day|jalali_weekday == 'Ø¬Ù…Ø¹Ù‡' %}table-danger{% endif %}">
                  <td class="text-center fw-bold">{{ day|to_jalali }}</td>
                  <td class="text-center">{{ day|jalali_weekday }}</td>
                  <td>
                    {% if todos %}
                      <div class="d-flex flex-wrap gap-2">
                        {% for todo in todos %}
                          <a href="{% url 'todo:todo_detail' todo.id %}"
                            class="btn btn-sm
                         {% if todo.is_completed %}
                              
                           btn-success text-decoration-line-through

                            {% elif todo.priority == 'high' %}
                              
                           btn-danger

                            {% elif todo.priority == 'medium' %}
                              
                           btn-warning

                            {% else %}
                              
                           btn-info

                            {% endif %}
                         ">
                            {{ todo.title }}
                          </a>
                        {% endfor %}
                      </div>
                    {% else %}
                      <span class="text-muted">â€” Ú©Ø§Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- ØªØ¨ Ø¢ÛŒÙ†Ø¯Ù‡ -->
      <div class="tab-pane fade" id="future">
        {% if future_todos %}
          <div class="list-group shadow-sm">
            {% for todo in future_todos %}
              <a href="{% url 'todo:todo_detail' todo.id %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge me-2
                  {% if todo.priority == 'high' %}
                      bg-danger

                    {% elif todo.priority == 'medium' %}
                      bg-warning text-dark

                    {% else %}
                      bg-info
                    {% endif %}
                ">
                    {{ todo.get_priority_display }}
                  </span>
                  {{ todo.title }}
                </div>
                <small class="text-muted">{{ todo.due_date|to_jalali }}</small>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-light text-center">ğŸ‰ Ú©Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>
        {% endif %}
      </div>

      <!-- ØªØ¨ Ú©Ø§Ø± Ø¹Ù‚Ø¨ Ø§ÙØªØ§Ø¯ Ú¯Ø°Ø´ØªÙ‡ -->
      <div class="tab-pane fade" id="past">
        {% if past_todos %}
          <div class="list-group shadow-sm">
            {% for todo in past_todos %}
              <a href="{% url 'todo:todo_detail' todo.id %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge {% if todo.priority == 'high' %}
                      
                           btn-danger

                    {% elif todo.priority == 'medium' %}
                      
                           btn-warning

                    {% else %}
                      
                           btn-info

                    {% endif %} me-2">
                    Ø¹Ù‚Ø¨â€ŒØ§ÙØªØ§Ø¯Ù‡
                  </span>
                  {{ todo.title }}
                </div>
                <small class="text-muted">{{ todo.due_date|to_jalali }}</small>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-light text-center">ğŸ‰ Ú©Ø§Ø± Ø¹Ù‚Ø¨â€ŒØ§ÙØªØ§Ø¯Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>
        {% endif %}
      </div>

      <!-- ØªØ¨ Ø«Ø¨Øª ÙˆØ¸ÛŒÙÙ‡ -->
      <div class="tab-pane fade" id="create">
        <div class="card shadow-sm">
          <div class="card-body">

            <form method="post">
              {% csrf_token %}
              {{ form.as_p }}
              <button type="submit" class="btn btn-primary">Ø«Ø¨Øª</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
