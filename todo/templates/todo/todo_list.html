{% extends 'base.html' %}
{% load jalali_filters %}
{% load static %}

{% block content %}
<div class="container py-4" dir="rtl">

  <!-- Ø¹Ù†ÙˆØ§Ù† -->
  <div class="mb-4">
    <h3 class="fw-bold">ğŸ“‹ ÙˆØ¸Ø§ÛŒÙ Ù…Ù†</h3>
  </div>

  <!-- ØªØ¨â€ŒÙ‡Ø§ -->
  <ul class="nav nav-tabs mb-4" id="todoTabs" role="tablist">

    <!-- Û±Û´ Ø±ÙˆØ² -->
    <li class="nav-item" role="presentation">
      <button class="nav-link active"
              id="days-tab"
              data-bs-toggle="tab"
              data-bs-target="#days"
              type="button">
        ğŸ“… Û±Û´ Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡
      </button>
    </li>

    <!-- Ø¢ÛŒÙ†Ø¯Ù‡ -->
    <li class="nav-item" role="presentation">
      <button class="nav-link"
              id="future-tab"
              data-bs-toggle="tab"
              data-bs-target="#future"
              type="button">
        â³ Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡
        {% if future_todos %}
          <span class="badge bg-warning text-dark ms-1">{{ future_todos|length }}</span>
        {% endif %}
      </button>
    </li>

    <!-- Ø«Ø¨Øª -->
    <li class="nav-item ms-auto" role="presentation">
      <button class="nav-link text-success"
              id="create-tab"
              data-bs-toggle="tab"
              data-bs-target="#create"
              type="button">
        â• Ø«Ø¨Øª ÙˆØ¸ÛŒÙÙ‡
      </button>
    </li>

  </ul>

  <!-- Ù…Ø­ØªÙˆØ§ÛŒ ØªØ¨â€ŒÙ‡Ø§ -->
  <div class="tab-content">

    <!-- ØªØ¨ Û±Û´ Ø±ÙˆØ² -->
    <div class="tab-pane fade show active" id="days">
      <div class="table-responsive shadow-sm rounded">
        <table class="table table-bordered align-middle mb-0">
          <thead class="table-light text-center">
            <tr>
              <th style="width:140px;">ØªØ§Ø±ÛŒØ®</th>
              <th style="width:120px;">Ø±ÙˆØ²</th>
              <th>Ú©Ø§Ø±Ù‡Ø§</th>
            </tr>
          </thead>
          <tbody>
            {% for day, todos in days_dict.items %}
            <tr class="{% if day|jalali_weekday == 'Ø¬Ù…Ø¹Ù‡' %}table-danger{% endif %}">
              <td class="text-center fw-bold">{{ day|to_jalali }}</td>
              <td class="text-center">{{ day|jalali_weekday }}</td>
              <td>
                {% if todos %}
                  <div class="d-flex flex-wrap gap-2">
                    {% for todo in todos %}
                      <a href="{% url 'todo:todo_detail' todo.id %}"
                         class="btn btn-sm
                         {% if todo.is_completed %}
                           btn-success text-decoration-line-through
                         {% elif todo.priority == 'high' %}
                           btn-danger
                         {% elif todo.priority == 'medium' %}
                           btn-warning
                         {% else %}
                           btn-info
                         {% endif %}
                         ">
                        {{ todo.title }}
                      </a>
                    {% endfor %}
                  </div>
                {% else %}
                  <span class="text-muted">â€” Ú©Ø§Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- ØªØ¨ Ø¢ÛŒÙ†Ø¯Ù‡ -->
    <div class="tab-pane fade" id="future">
      {% if future_todos %}
        <div class="list-group shadow-sm">
          {% for todo in future_todos %}
            <a href="{% url 'todo:todo_detail' todo.id %}"
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              <div>
                <span class="badge me-2
                  {% if todo.priority == 'high' %}bg-danger
                  {% elif todo.priority == 'medium' %}bg-warning text-dark
                  {% else %}bg-info{% endif %}
                ">
                  {{ todo.get_priority_display }}
                </span>
                {{ todo.title }}
              </div>
              <small class="text-muted">{{ todo.due_date|to_jalali }}</small>
            </a>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-light text-center">
          ğŸ‰ Ú©Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
        </div>
      {% endif %}
    </div>

    <!-- ØªØ¨ Ø«Ø¨Øª ÙˆØ¸ÛŒÙÙ‡ -->
    <div class="tab-pane fade" id="create">
      <div class="card shadow-sm">
        <div class="card-body">

          <form method="post">
            {% csrf_token %}

            <div class="mb-3">
              <label class="form-label fw-bold">Ø¹Ù†ÙˆØ§Ù†</label>
              <input type="text" name="title" class="form-control" required>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
              <textarea name="description" rows="3" class="form-control"></textarea>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label fw-bold">ØªØ§Ø±ÛŒØ® Ø§Ù†Ø¬Ø§Ù…</label>
                <input type="date" name="due_date" class="form-control">
              </div>
              <div class="col-md-6">
                <label class="form-label fw-bold">Ø³Ø§Ø¹Øª</label>
                <input type="time" name="due_time" class="form-control">
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Ø§ÙˆÙ„ÙˆÛŒØª</label>
              <select name="priority" class="form-select">
                <option value="low">Ú©Ù…</option>
                <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
                <option value="high">Ø²ÛŒØ§Ø¯</option>
              </select>
            </div>

            <div class="text-end">
              <button type="submit" class="btn btn-primary px-4">
                 Ø«Ø¨Øª ÙˆØ¸ÛŒÙÙ‡
              </button>
            </div>

          </form>

        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
